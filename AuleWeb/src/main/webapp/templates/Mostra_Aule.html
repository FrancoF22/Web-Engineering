<!-- collegare eventi (info.html) nell href -->
<link rel="stylesheet" href="style/mostra_aule.css" type="text/css" />

<div class="home-container">

    <div class="calendar-and-events-container">
        <div class="events-container">
            <!-- Inserisci qui la visualizzazione degli eventi del giorno -->
            <h2>Eventi di Oggi</h2>
            <ul id="eventList">
                <!-- Gli eventi verranno visualizzati qui -->
            </ul>
            <div id="eventDetails">
                <!-- Dettagli degli eventi verranno visualizzati qui -->
            </div>
        </div>

        <!-- Contenitore per l'orario del giorno -->
        <div class="time-container">
            <!-- Inserisci qui l'orario del giorno -->
            <h2>Orario del Giorno</h2>
            <ul id="timeList">
                <!-- L'orario verrà visualizzato qui -->
            </ul>
        </div>

        <div id="calendar">
            <button id="currentDateButton">Data Corrente</button>
            <div class="header">
                <button id="prevMonth">&lt;</button>
                <h1 id="currentMonth"></h1>
                <button id="nextMonth">&gt;</button>
            </div>
            <div class="days">
                <!-- Inserire qui i giorni del mese -->
            </div>
        </div>
    </div>

    <div class="home-home">
        <div class="lower">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Luogo</th>
                        <th>Edificio</th>
                        <th>Piano</th>
                        <th>Capienza</th>
                        <th>Numero di prese elettriche</th>
                        <th>Numero di prese di rete</th>
                        <th>Professore</th>
                        <th>Attrezzature</th>
                        <th>Azione</th>
                    </tr>
                </thead>
                <tbody>
                    <#if (ListaAule?size>0)>
                    <#list ListaAule as aula>
                    <tr>
                        <td>${aula.nome}</td>
                        <td>${aula.luogo}</td>
                        <td>${aula.edificio}</td>
                        <td>${aula.piano}</td>
                        <td>${aula.capienza}</td>
                        <td>${aula.preseElettriche}</td>
                        <td>${aula.preseRete}</td>
                        <td><#if aula.professore??>${aula.professore.nome} ${aula.professore.cognome}</#if></td>
                        <td>
                            <#list aula.attrezzature as att>
                            ${att},
                            </#list>
                        </td>
                        <!-- <td><a href="eventi?id=${aula.key}">[visualizza eventi]</a></td> -->
                        <td><a href="eventi?id=${aula.key}"><button class="Bottone-tabella">Eventi Aula</button></a></td>
                    </tr>
                    </#list>
                    </#if>
                </tbody>            
            </table>
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const prevMonthButton = document.getElementById('prevMonth');
        const nextMonthButton = document.getElementById('nextMonth');
        const currentMonthElement = document.getElementById('currentMonth');
        const daysContainer = document.querySelector('.days');
        const currentDateButton = document.getElementById('currentDateButton'); // Seleziona il pulsante "Data Corrente"
        const eventList = document.getElementById('eventList');
        const eventDetails = document.getElementById('eventDetails'); // Nuovo elemento per i dettagli degli eventi

        // Ottieni l'anno corrente dalla data locale
        const currentYear = new Date().getFullYear();

        let currentDate = new Date();

        function renderCalendar() {
            const year = currentYear; // Utilizza l'anno corrente
            const month = currentDate.getMonth();
            const options = {year: 'numeric', month: 'long'};
            currentMonthElement.textContent = currentDate.toLocaleDateString('it-IT', options);
            // Pulisci il container dei giorni
            daysContainer.innerHTML = '';
            const today = new Date(); // Ottieni la data odierna
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            // Aggiungi i giorni del mese
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.textContent = day;
                dayElement.classList.add('day');
                // Aggiungi la classe "day" per identificare i giorni
                const date = new Date(year, month, day);
                dayElement.setAttribute('data-date', date.toISOString().split('T')[0]);


                // Aggiungi la classe "current-day" se il giorno è uguale a oggi
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    dayElement.classList.add('current-day');
                }

                daysContainer.appendChild(dayElement);
            }
        }

        renderCalendar();
        prevMonthButton.addEventListener('click', function () {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });
        nextMonthButton.addEventListener('click', function () {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });
        currentDateButton.addEventListener('click', function () {
            currentDate = new Date(); // Reimposta la data corrente
            renderCalendar();
        });

        // Aggiungi un listener per il click sui giorni del calendario
        daysContainer.addEventListener('click', function (event) {
            const clickedDayElement = event.target;
            if (clickedDayElement.classList.contains('day')) {
                const selectedDate = new Date(clickedDayElement.getAttribute('data-date'));

                // Visualizza gli eventi per la data selezionata
                renderEventsForDay(selectedDate);
                // Aggiorna l'orario del giorno per la data selezionata
                populateTimeList(selectedDate);
            }
        });

        function renderEventsForDay(selectedDate) {
            // Simula il recupero degli eventi dal backend o da un'altra fonte dati
            const events = getEventsForDate(selectedDate);

            // Aggiungi questo console.log per verificare i dati degli eventi
            console.log('Eventi per la data selezionata:', events);

            // Visualizza gli eventi nell'elenco degli eventi
            eventList.innerHTML = '';
            if (events.length > 0) {
                events.forEach(event => {
                    const listItem = document.createElement('li');
                    listItem.textContent = event;
                    eventList.appendChild(listItem);
                });
            } else {
                const noEventItem = document.createElement('li');
                noEventItem.textContent = 'Nessun evento per questo giorno.';
                eventList.appendChild(noEventItem);
            }

            // Visualizza i dettagli degli eventi nell'area degli eventDetails
            eventDetails.innerHTML = '';
            if (events.length > 0) {
                events.forEach(event => {
                    const eventDetail = document.createElement('div');
                    eventDetail.textContent = event;
                    eventDetails.appendChild(eventDetail);
                });
            } else {
                const noEventDetail = document.createElement('div');
                noEventDetail.textContent = 'Nessun evento per questo giorno.';
                eventDetails.appendChild(noEventDetail);
            }
        }

        // Modifica la funzione per accettare un parametro date e filtrare l'orario per quella data
        function populateTimeList(date) {
            var timeList = document.getElementById("timeList");
            timeList.innerHTML = ''; // Pulisci la lista prima di popolarla

            // Filtra o genera l'orario per la data selezionata
            var dailySchedule = getScheduleForDate(date);
            dailySchedule.forEach(function (item) {
                var li = document.createElement("li");
                li.textContent = item.time + ": " + item.subject;
                timeList.appendChild(li);
            });
        }

        // Funzione di esempio per ottenere gli eventi per una data specifica
        function getEventsForDate(date) {
            // Simula il recupero degli eventi dal backend o da un database
            const events = {
                '2023-10-30': ['Evento 1', 'Evento 2'],
                '2023-10-31': ['Evento 3'],
                // Aggiungi altri dati sugli eventi qui
            };
            const formattedDate = formatDate(date);
            return events[formattedDate] || [];
        }

        function formatDate(date) {
            const formattedDate = date.toLocaleDateString('it-IT', {year: 'numeric', month: 'long', day: 'numeric'});
            return formattedDate;
        }
    });

    // Array di oggetti per definire le fasce orarie
    var schedule = [
        {time: "08:30 - 09:30"},
        {time: "09:30 - 10:30"},
        {time: "10:30 - 11:30"},
        {time: "11:30 - 12:30"},
        {time: "12:30 - 13:30"},
        {time: "13:30 - 14:30"},
        {time: "14:30 - 15:30"},
        {time: "15:30 - 16:30"},
        {time: "16:30 - 17:30"},
        {time: "17:30 - 18:30"},
        {time: "18:30 - 19:30"},
        {time: "19:30 - 20:30"},
    ];

    // Funzione di esempio per ottenere l'orario per una data specifica
    function getScheduleForDate(date) {
        // Simula il recupero dell'orario dal backend o da un database
        // Qui dovresti sostituire questa logica con una che effettivamente recuperi i dati per la data specificata
        const scheduleForDate = {
            // ... (esempio di dati dell'orario, organizzati per data)
        };
        const formattedDate = date.toISOString().split('T')[0];
        return scheduleForDate[formattedDate] || [];
    }

// Chiama la funzione per popolare l'orario del giorno al caricamento della pagina
    window.addEventListener("DOMContentLoaded", populateTimeList);
</script>

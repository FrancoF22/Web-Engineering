

<link href="style/mostra_eventi.css" rel="stylesheet" />
<title>Aule web </title>
<div class="container">

    <div class="lower">
        <label>Filtra per data:</label>
        <#if aula??>
        <form action="eventi?id=${eventi.key}" method="post">
            <input style="border: solid 1px black ;" type="date" id="filtroData" name="datepick" required>
            <input style=" border: solid 1px black; background-color: skyblue; border-radius: 7px;  " type="submit" value="Eventi settimana" name="button1">
            <input style=" border: solid 1px black; background-color: skyblue; border-radius: 7px;  " type="submit" value="Eventi del giorno" name="button2">
        </form>
        </#if>
        <a href="eventi?id_aula=${aula!'default_value'}"><button style="border: solid 1px black; background-color: skyblue; border-radius: 7px;  ">Tutti</button></a>

        <table id="dataTable" >
            <thead>

                <tr>
                    <th>Data</th>
                    <th>Inizio</th>
                    <th>Fine</th>
                    <th>Aula</th>
                    <th>Nome Evento</th>
                    <th>Descrizione</th>
                    <th>Corso</th>
                    <th>Azione</th>
                </tr>
            </thead>
            <tbody>
                <#if (ListaEventi?size>0)>
                <#list ListaEventi as calendario>
                <tr>
                    <td>${calendario.giorno?date?string('dd-MM-yyyy')}</td>
                    <td>${calendario.oraInizio?time?string('HH:mm')}</td>
                    <td>${calendario.oraFine?time?string('HH:mm')}</td>
                    <td>${calendario.aula.nome}</td>
                    <td>${calendario.evento.nome}</td>
                    <td>${calendario.evento.descrizione}</td>
                    <td><#if calendario.evento.corso??>${calendario.evento.corso.nome} &nbsp; <a href="eventi-corso?corso=${calendario.evento.corso.id}&id_aula=${calendario.aula.id}"><button name="seleziona">Eventi associati</button></#if></a></td>
                    <td><a href="info-evento?evento_key=${calendario.evento.id}&giorno=${calendario.giorno?date?string('yyyy-MM-dd')}"><button name="seleziona">Seleziona</button></a></td>
                </tr>
                </#list>
                </#if>
            </tbody>            
        </table>
        <button class="my-button" id="downloadBtn" >Scarica in CSV</button>
        <a  href="aule?id_gruppo=${gruppo.key}"><button class="my-button">Indietro</button></a>
    </div>
</div>

<script>
    document.getElementById('downloadBtn').addEventListener('click', function () {
        downloadCSV();
    });

    function downloadCSV() {
        var table = document.getElementById('dataTable');
        var rows = table.getElementsByTagName('tr');
        var csvData = [];

        // Loop attraverso le righe della tabella e creare un array di array per i dati CSV
        for (var i = 0; i < rows.length; i++) {
            var row = [], cols = rows[i].querySelectorAll('td, th');

            for (var j = 0; j < cols.length - 1; j++) {
                row.push(cols[j].innerText);
            }

            csvData.push(row.join(','));
        }

        // Unisci i dati CSV in un'unica stringa
        var csvString = csvData.join('\n');

        // Crea un oggetto Blob con i dati CSV
        var blob = new Blob([csvString], {type: 'text/csv'});

        // Crea un URL temporaneo per il download del file CSV
        var url = window.URL.createObjectURL(blob);

        // Crea un elemento "a" nascosto e simula il clic per avviare il download del file
        var a = document.createElement('a');
        a.href = url;
        a.download = 'dati.csv';
        document.body.appendChild(a);
        a.click();

        // Rimuovi l'elemento "a" nascosto
        document.body.removeChild(a);
    }
</script>


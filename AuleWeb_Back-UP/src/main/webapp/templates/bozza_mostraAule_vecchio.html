<link rel="stylesheet" href="style/mostra_aule.css" type="text/css" />

<!-- FullCalendar CSS -->
<link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css' rel='stylesheet' />
<!-- Dipendenze richieste da FullCalendar -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
<!-- FullCalendar script e locale italiano-->
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/locale/it.js'></script>




<div class="home-container">

    <div id="calendar"></div>

    <div class="home-home">
        <div class="lower">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Luogo</th>
                        <th>Edificio</th>
                        <th>Piano</th>
                        <th>Capienza</th>
                        <th>Numero di prese elettriche</th>
                        <th>Numero di prese di rete</th>
                        <th>Professore</th>
                        <th>Attrezzature</th>
                        <th>Azione</th>
                    </tr>
                </thead>
                <tbody>
                    <#if (ListaAule?size>0)>
                    <#list ListaAule as aula>
                    <tr>
                        <td>${aula.nome}</td>
                        <td>${aula.luogo}</td>
                        <td>${aula.edificio}</td>
                        <td>${aula.piano}</td>
                        <td>${aula.capienza}</td>
                        <td>${aula.preseElettriche}</td>
                        <td>${aula.preseRete}</td>
                        <td><#if aula.professore??>${aula.professore.nome} ${aula.professore.cognome}</#if></td>
                        <td>
                            <#list aula.attrezzature as att>
                            ${att},
                            </#list>
                        </td>
                        <!-- <td><a href="eventi?id=${aula.key}">[visualizza eventi]</a></td> -->
                        <td><a class="Bottone-tabella" href="evento?id=${aula.key}">Eventi Aula</a></td>
                    </tr>
                    </#list>
                    </#if>
                </tbody>            
            </table>
        </div>
    </div>

</div>

<script>
    $(document).ready(function () {

        // Funzione per impostare l'ora d'inizio e fine di default
        function setDefaultStartEndTime() {
            var now = new Date();
            var startTime = moment(now).format('HH:mm'); // Ora attuale
            var endTime = moment(now).add(1, 'hours').format('HH:mm'); // Un'ora dopo

            $('#start-time').val(startTime); // Imposta l'ora d'inizio
            $('#end-time').val(endTime); // Imposta l'ora di fine
        }

        // Inizializzazione di FullCalendar
        $('#calendar').fullCalendar({
            // Opzioni di configurazione
            locale: 'it',
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            // Gestione del click su un giorno
            dayClick: function (date, jsEvent, view) {
                var formattedDate = date.format(); // Formatta la data come desideri, ad esempio "YYYY-MM-DD"
                $('#date').val(formattedDate); // Imposta il valore del campo "Data" nel form

                setDefaultStartEndTime(); // Imposta l'ora d'inizio e fine di default
                // (Opzionale) Apri una modalità di dialogo o sposta lo scroll alla form
            },
            editable: true, // Rende gli eventi trascinabili e modificabili
            events: fetchEvents // Carica gli eventi tramite la funzione fetchEvents
        });

        // Funzione per recuperare gli eventi dalla servlet
        function fetchEvents(start, end, timezone, callback) {
            fetch('/evento?action=getEvents&start=' + start.format() + '&end=' + end.format())
                    .then(response => response.text())
                    .then(textResponse => {
                        var events = parseEventsFromTextResponse(textResponse);
                        callback(events);
                    })
                    .catch(error => console.error('Error fetching events:', error));
        }

        $('#event-form').on('submit', function (e) {
            e.preventDefault();
            var eventData = {
                room: $('#room').val(),
                event: $('#event').val(),
                date: $('#date').val(),
                startTime: $('#start-time').val(),
                endTime: $('#end-time').val(),
                // Aggiungi altri campi se necessario
            };

            // Invia i dati dell'evento alla servlet
            submitEvent(eventData);
        });

        // Gestione del form di invio degli eventi
        $('#event-form').on('submit', function (e) {
            e.preventDefault();

            // Raccogli i dati del form
            var eventData = {
                room: $('#room').val(),
                event: $('#event').val(),
                date: $('#date').val(),
                startTime: $('#start-time').val(),
                endTime: $('#end-time').val(),
                // repetition: $('#repetition').val(), // Aggiungi altri campi se necessario
            };

            submitEvent(eventData);// Invia i dati dell'evento alla servlet
        });

        function submitEvent(eventData) {
            // Qui dovrai modificare per adattarti al formato di dati atteso dalla tua servlet
            // In questo esempio, inviamo dati come query string, ma potrebbe essere necessario inviare come form data
            fetch('/evento?action=submitEvent&room=' + eventData.room + '&date=' + eventData.date + '&startTime=' + eventData.startTime + '&endTime=' + eventData.endTime, {
                method: 'POST'
            })
                    .then(() => {
                        $('#calendar').fullCalendar('refetchEvents');
                    })
                    .catch(error => console.error('Error submitting event:', error));
        }

        setDefaultStartEndTime();// Imposta l'ora d'inizio e fine di default quando la pagina è caricata
    });
</script>

<style>
    /* Impostazioni base */
body {
    font-family: 'Arial', sans-serif;
    color: #333;
    margin: 0;
    padding: 0;
    background-color: #f0f0f0;
    line-height: 1.6; /* Spazio tra le righe */
    font-size: 16px; /* Dimensione standard del testo */
}

/* Stili per il contenitore del calendario e degli eventi */
.calendar-and-events-container {
    display: flex;
    flex-wrap: wrap; /* Ora permette agli elementi di andare a capo quando necessario */
    justify-content: space-between;
    margin: 30px auto; /* Centrato con margini più ampi */
    max-width: 1200px; /* Massima larghezza per evitare che sia troppo esteso su schermi grandi */
    padding: 20px;
    box-sizing: border-box; /* Assicura che padding e bordi siano inclusi nella larghezza */
}

.events-container,
.time-container,
#calendar {
    flex: 1; /* Ora i contenitori occupano la stessa quantità di spazio disponibile */
    border: 1px solid #ccc;
    border-radius: 10px; /* Bordi più arrotondati */
    padding: 20px;
    margin: 10px;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    background: linear-gradient(to bottom, #f9f9f9, #ffffff);
}

.events-container h2,
.time-container h2 {
    font-size: 16px; /* Dimensione del titolo */
}

#eventList,
#timeList {
    list-style: none;
    padding: 0;
    margin: 0;
}

#eventList li,
#timeList li {
    margin-bottom: 5px;
}

@media (max-width: 767px) {
    .events-container, .time-container, #calendar {
        width: 100%; /* Permette che i contenitori occupino l'intera larghezza su schermi più piccoli */
        margin-top: 20px; /* Distanziamento tra i contenitori */
    }
}

#calendar {
    display: flex;
    flex-direction: column;
}

#calendar .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

#calendar h1,
.events-container h2 {
    color: #0056b3;
}

#calendar .days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    text-align: center;
}

.day {
    padding: 15px;
    background-color: #e9e9e9;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.3s ease;
}

.day:hover, .day.current-day {
    background-color: #0066cc;
    color: #ffffff;
    transform: translateY(-3px); /* Leggero effetto "sollevamento" */
}

/* Rimozione delle regole di stile duplicate per la tabella delle aule */
.custom-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

.custom-table th, .custom-table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

.custom-table th {
    background-color: #007bff;
    color: #ffffff;
}

.custom-table tr:nth-child(odd) {
    background-color: #f2f2f2;
}

.custom-table tr:hover {
    background-color: #e0e0e0;
}

.Bottone-tabella {
    background-color: #007bff;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    display: inline-block; /* Per evitare problemi di allineamento */
    text-decoration: none; /* Se è un link */
}

.Bottone-tabella:hover {
    background-color: #0056b3;
    transform: scale(1.05); /* Leggero effetto di zoom */
}

.Bottone-tabella:focus {
    box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.5); /* Focus visibile per l'accessibilità */
}

.Bottone-tabella:active {
    background-color: #004a9f; /* Colore leggermente più scuro per lo stato attivo */
}

/* Stile Base per i Bottoni */
#prevMonth, #nextMonth, #currentDateButton {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
    font-size: 16px; /* Assicurati che sia leggibile */
    margin: 5px; /* Spazio tra i bottoni */
}

#prevMonth:hover, #nextMonth:hover, #currentDateButton:hover {
    background-color: #0056b3;
    transform: scale(1.05);
}

/* Aggiunta di iconografia ai bottoni può aiutare nell'usabilità */
#prevMonth:before {
    content: "\003C"; /* Codice Unicode per '<' */
    display: inline-block;
    margin-right: 5px;
}

#nextMonth:after {
    content: "\003E"; /* Codice Unicode per '>' */
    display: inline-block;
    margin-left: 5px;
}

/* Se desideri rendere il bottone Data Corrente diverso */
#currentDateButton {
    background-color: #17a2b8; /* Blu più chiaro */
}

#currentDateButton:hover {
    background-color: #138496; /* Un blu leggermente più scuro per l'hover */
}

.header {
    display: flex;
    justify-content: center; /* Centrato orizzontalmente */
    align-items: center; /* Centrato verticalmente */
    margin-bottom: 20px;
}

.header h1 {
    margin: 0 20px; /* Aggiunge spazio tra il testo e i bottoni */
    color: #0056b3; /* Manteniamo il colore coerente */
    font-size: 1.5em;
}

.selected-day {
    background-color: #FFD700; /* o qualsiasi altro colore preferisci */
    color: white;
}

.events-container ul {
    list-style-type: none;
    padding: 0;
}

.events-container li {
    margin-bottom: 20px;
    padding: 10px;
    background: #f9f9f9;
    border: 1px solid #ddd;
}

.events-container h3 {
    margin-top: 0;
}

.events-container div,
.events-container p {
    margin: 5px 0;
}

</style>
<meta charset="UTF-8">
<link rel="stylesheet" href="style/calendario.css" type="text/css" />
<!-- FullCalendar CSS -->
<link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css' rel='stylesheet' />
<!-- Dipendenze richieste da FullCalendar -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
<!-- FullCalendar script -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js'></script>

<div id="calendar"></div>

<form id="event-form">
    <div class="form-title">Gestisci Eventi</div>

    <label for="room">Aula:</label>
    <select id="room" name="room">
        <!-- Le opzioni saranno aggiunte dinamicamente via JavaScript -->
    </select>

    <label for="date">Data:</label>
    <input type="date" id="date" name="date">

    <label for="start-time">Ora Inizio:</label>
    <input type="time" id="start-time" name="start-time">

    <label for="end-time">Ora Fine:</label>
    <input type="time" id="end-time" name="end-time">

    <!-- Opzioni di ripetibilità -->
    <label for="repetition">Ripetibilit&agrave;:</label>
    <select id="repetition" name="repetition">
        <option value="none">Nessuna</option>
        <option value="daily">Giornaliera</option>
        <option value="weekly">Settimanale</option>
        <option value="monthly">Mensile</option>
    </select>

    <input type="submit" value="Aggiungi/Modifica Evento">
</form>


<script>
    $(document).ready(function () {
        // Inizializzazione di FullCalendar
        $('#calendar').fullCalendar({
            // Opzioni di configurazione
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            // Gestione del click su un giorno
            dayClick: function (date, jsEvent, view) {
                var formattedDate = date.format();// Formatta la data come desideri, ad esempio "YYYY-MM-DD"
                $('#date').val(formattedDate);// Imposta il valore del campo "Data" nel form

                // (Opzionale) Apri una modalità di dialogo o sposta lo scroll alla form
            },
            editable: true, // Rende gli eventi trascinabili e modificabili
            events: function (start, end, timezone, callback) {
                $.ajax({
                    url: 'lista_eventi', //'path_to_your_servlet_for_loading_events',
                    dataType: 'json',
                    data: {
                        // Parametri che potresti dover inviare alla servlet
                        start: start.format(),
                        end: end.format()
                    },
                    success: function (response) {
                        var events = [];
                        // Elabora la risposta per trasformarla in eventi di FullCalendar
                        response.forEach(function (event) {
                            events.push({
                                title: event.title,
                                start: event.start, // Assicurati che sia nel formato corretto
                                end: event.end // Assicurati che sia nel formato corretto
                                        // Altre proprietà dell'evento...
                            });
                        });
                        callback(events);
                    }
                });
            }
        });
        // Carica le aule all'avvio
        fetchClassrooms();

        // Funzione per caricare le aule
        function fetchClassrooms() {
            $.ajax({
                url: 'lista_aule',//'path_to_aula_servlet', // Aggiorna con il percorso corretto
                type: 'GET',
                dataType: 'json',
                success: function (aulas) {
                    var roomSelect = $('#room');
                    aulas.forEach(function (aula) {
                        roomSelect.append(new Option(aula.nome, aula.id)); // Assumi che 'nome' e 'id' siano i campi dell'oggetto 'aula'
                    });
                },
                error: function () {
                    alert('Errore nel caricamento delle aule');
                }
            });
        }

        // Gestione del form di invio degli eventi
        $('#event-form').on('submit', function (e) {
            e.preventDefault();

            // Raccogli i dati del form
            var eventData = {
                room: $('#room').val(),
                date: $('#date').val(),
                startTime: $('#start-time').val(),
                endTime: $('#end-time').val(),
                repetition: $('#repetition').val()
            };

            // Invia i dati alla servlet tramite AJAX
            $.ajax({
                url: 'add_mod_evento', //'path_to_your_servlet_for_event_creation_or_modification',
                type: 'POST',
                data: eventData,
                success: function (response) {
                    // Codice per gestire la risposta, aggiornare il calendario, ecc.
                    // Esempio: ricarica gli eventi nel calendario
                    $('#calendar').fullCalendar('refetchEvents');
                },
                error: function () {
                    // Gestisci errori
                    alert('Si è verificato un errore durante il salvataggio dell\'evento.');
                }
            });
        });

    });
</script>


